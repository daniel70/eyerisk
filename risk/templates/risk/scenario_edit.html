{% extends "risk/base.html" %}
{% load staticfiles %}
{% load bootstrap %}
{% block content %}
{{ form.non_field_errors }}

<form class="form" method="post" action="">
    {% csrf_token %}
    {% for hidden in form.hidden_fields %}
        {{ hidden }}
    {% endfor %}
    {{ risk_type_answer_formset.management_form }}
    {{ process_enabler_answer_formset.management_form }}
    {{ enabler_answer_formset.management_form }}

    <div class="scenario">
    <div class="row scenario-title text-center">
        <div class="col-md-12">
            Risk Scenario Category {{form.instance.scenario_category.nr}}: {{form.instance.scenario_category.name}}
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <b>Risk Scenario</b><br>
            {{form.instance.scenario_category.risk_scenario}}
        </div>
    </div>
    <div class="row scenario-divider">
        <div class="col-md-12">
            Risk Scenario Components
        </div>
    </div>

    {% with field=form.threat_type %}
    <div class="row">
        <div class="col-md-6">
            <b>{{ field.label_tag }}</b><br>
            <small>{{ field.help_text }}</small>
        </div>
        <div class="col-md-6">
            {% for choice in field %}
            <div class="checkbox">
                {{ choice }}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endwith %}

    {% with field=form.actor %}
    <div class="row">
        <div class="col-md-6">
            <b>{{ field.label_tag }}</b><br>
            <small>{{ field.help_text }}</small>
        </div>
        <div class="col-md-6">
            {% for choice in field %}
            <div class="checkbox">
                {{ choice }}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endwith %}

    {% with field=form.event %}
    <div class="row">
        <div class="col-md-6">
            <b>{{ field.label_tag }}</b><br>
            <small>{{ field.help_text }}</small>
        </div>
        <div class="col-md-6">
            {% for choice in field %}
            <div class="checkbox">
                {{ choice }}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endwith %}

    {% with field=form.asset %}
    <div class="row">
        <div class="col-md-6">
            <b>{{ field.label_tag }}</b><br>
            <small>{{ field.help_text }}</small>
        </div>
        <div class="col-md-6">
            {% for choice in field %}
            <div class="checkbox">
                {{ choice }}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endwith %}

    {% with field=form.resource %}
    <div class="row">
        <div class="col-md-6">
            <b>{{ field.label_tag }}</b><br>
            <small>{{ field.help_text }}</small>
        </div>
        <div class="col-md-6">
            {% for choice in field %}
            <div class="checkbox">
                {{ choice }}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endwith %}

    {% with field=form.timing %}
    <div class="row">
        <div class="col-md-6">
            <b>{{ field.label_tag }}</b><br>
            <small>{{ field.help_text }}</small>
        </div>
        <div class="col-md-6">
            {% for choice in field %}
            <div class="radio">
                {{ choice }}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endwith %}

    {% with field=form.duration %}
    <div class="row">
        <div class="col-md-6">
            <b>{{ field.label_tag }}</b><br>
            <small>{{ field.help_text }}</small>
        </div>
        <div class="col-md-6">
            {% for choice in field %}
            <div class="radio">
                {{ choice }}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endwith %}

    {% with field=form.detection %}
    <div class="row">
        <div class="col-md-6">
            <b>{{ field.label_tag }}</b><br>
            <small>{{ field.help_text }}</small>
        </div>
        <div class="col-md-6">
            {% for choice in field %}
            <div class="radio">
                {{ choice }}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endwith %}

    {% with field=form.time_lag %}
    <div class="row">
        <div class="col-md-6">
            <b>{{ field.label_tag }}</b><br>
            <small>{{ field.help_text }}</small>
        </div>
        <div class="col-md-6">
            {% for choice in field %}
            <div class="radio">
                {{ choice }}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endwith %}


    <div class="row scenario-divider">
        <div class="col-md-12">
            Risk Type<br>
            <small>Describe the consequences resulting from the event.
            Include whether the risk type is primary or secondary.</small>
        </div>
    </div>
    <div class="row scenario-header">
        <div class="col-md-4 text-center">
            Risk Type
        </div>
        <div class="col-md-1 text-center">
            <abbr title="Primary / Secundary">P/S</abbr>
        </div>
        <div class="col-md-7 text-center">
            Risk Description
        </div>
    </div>

    {% for risk_type_answer_form in risk_type_answer_formset %}
        <div class="row">
            {% for hidden in risk_type_answer_form.hidden_fields %}
            {{ hidden }}
            {% endfor %}
            <div class="col-md-4">
                {{ risk_type_answer_form.instance.risk_type.description }}
            </div>
            <div class="col-md-1 text-center">
                {{ risk_type_answer_form.instance.risk_type.get_impact_display }}
            </div>
            <div class="col-md-7">
                {{ risk_type_answer_form.description }}
            </div>
        </div>
    {% endfor %}

    <div class="row scenario-divider">
        <div class="col-md-12">
            Process Enabler
        </div>
    </div>
    <div class="row scenario-header">
        <div class="col-md-1 text-center">
            Reference
        </div>
        <div class="col-md-2 text-center">
            Title Description
        </div>
        <div class="col-md-6 text-center">
            Governance and Management Practices
        </div>
        <div class="col-md-1 text-center">
            <abbr title="High / Medium / Low">Effect on Frequency</abbr>
        </div>
        <div class="col-md-1 text-center">
            <abbr title="High / Medium / Low">Effect on Impact</abbr>
        </div>
        <div class="col-md-1 text-center">
            <abbr title="Yes / No">Essential Control</abbr>
        </div>
    </div>

    {% for process_enabler_answer_form in process_enabler_answer_formset %}
        <div class="row">
            {% for hidden in process_enabler_answer_form.hidden_fields %}
            {{ hidden }}
            {% endfor %}
            <div class="col-md-1">
                {{ process_enabler_answer_form.instance.control_practice.practice_id }}
            </div>
            <div class="col-md-2">
                {{ process_enabler_answer_form.instance.control_practice.practice_name }}
            </div>
            <div class="col-md-6">
                {{ process_enabler_answer_form.instance.control_practice.practice_governance }}
            </div>
            <div class="col-md-1">
                <div class="form-group">
                    {{ process_enabler_answer_form.effect_on_frequency }}
                </div>
            </div>
            <div class="col-md-1">
                <div class="form-group">
                    {{ process_enabler_answer_form.effect_on_impact }}
                </div>
            </div>
            <div class="col-md-1">
                <div class="form-group">
                    {{ process_enabler_answer_form.essential_control }}
                </div>
            </div>
        </div>
    {% endfor %}

    {% for enabler_answer_form in enabler_answer_formset %}
        {% ifchanged enabler_answer_form.instance.enabler.type %}
        <div class="row scenario-divider">
            <div class="col-md-12">
                {{ enabler_answer_form.instance.enabler.get_type_display}}
            </div>
        </div>
        <div class="row scenario-header">
            <div class="col-md-3 text-center">
                Reference
            </div>
            <div class="col-md-6 text-center">
                Contribution to Response
            </div>
            <div class="col-md-1 text-center">
                <abbr title="High / Medium / Low">Effect on Frequency</abbr>
            </div>
            <div class="col-md-1 text-center">
                <abbr title="High / Medium / Low">Effect on Impact</abbr>
            </div>
            <div class="col-md-1 text-center">
                <abbr title="Yes / No">Essential Control</abbr>
            </div>
        </div>
        {% endifchanged %}

        <div class="row">
            {% for hidden in enabler_answer_form.hidden_fields %}
            {{ hidden }}
            {% endfor %}
            <div class="col-md-3">
                {{ enabler_answer_form.instance.enabler.reference }}
            </div>
            <div class="col-md-6">
                {{ enabler_answer_form.instance.enabler.contribution_to_response }}
            </div>
            <div class="col-md-1">
                <div class="form-group">
                    {{ enabler_answer_form.effect_on_frequency }}
                </div>
            </div>
            <div class="col-md-1">
                <div class="form-group">
                    {{ enabler_answer_form.effect_on_impact }}
                </div>
            </div>
            <div class="col-md-1">
                <div class="form-group">
                    {{ enabler_answer_form.essential_control }}
                </div>
            </div>
        </div>
    {% endfor %}
    </div>
    <br />
    <div class="form-group submit-row">
        <a href="{% url 'scenario-list' %}" class="btn btn-default">CANCEL</a>
        <button type="submit" class="btn btn-primary pull-right">SAVE</button>
    </div>

</form>
{% endblock content %}
